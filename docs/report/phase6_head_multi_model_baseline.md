# Phase 6 â€” ãƒ˜ãƒƒãƒ‰ãƒ‘ãƒƒãƒãƒ³ã‚° / ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆ3ãƒ¢ãƒ‡ãƒ«çµ±åˆãƒ¬ãƒãƒ¼ãƒˆï¼‰

## ğŸ¯ ç›®çš„
3ã¤ã®å°å‹ãƒ¢ãƒ‡ãƒ«ï¼ˆGPT-2 small, Pythia-160M, GPT-Neo-125Mï¼‰ã«ã¤ã„ã¦ã€æŒ‡å®šãƒ˜ãƒƒãƒ‰ã®å‡ºåŠ›ã‚’ã‚¼ãƒ­åŒ–ã—ã¦å› æœåŠ¹æœã‚’æ¸¬ã‚‹ï¼ˆhead ablationï¼‰ã€‚å„ãƒ˜ãƒƒãƒ‰ã‚’ç¶²ç¾…çš„ã«ã‚¢ãƒ–ãƒ¬ãƒ¼ãƒˆã—ã€è©•ä¾¡æŒ‡æ¨™ã®å¤‰åŒ–ã‹ã‚‰é‡è¦åº¦ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ã€‚

## ğŸ“¦ ç”Ÿæˆç‰©
- `results/baseline/screening/head_scores_gpt2_small.json`
- `results/baseline/screening/head_scores_pythia-160m.json`
- `results/baseline/screening/head_scores_gpt-neo-125m.json`
- `results/baseline/patching/head_patching/gpt2_small_head_ablation.pkl`
- `results/baseline/patching/head_patching/pythia-160m_head_ablation.pkl`
- `results/baseline/patching/head_patching/gpt-neo-125m_head_ablation.pkl`
- æœ¬ãƒ¬ãƒãƒ¼ãƒˆ: `docs/report/phase6_head_multi_model_baseline.md`

## ğŸš€ å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# Headã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆå…¨å±¤ï¼‰
python3 -m src.analysis.run_phase6_head_screening \
  --profile baseline \
  --model <model> \
  --layers 0 1 2 3 4 5 6 7 8 9 10 11 \
  --max-samples 8 \
  --sequence-length 30 \
  --device mps \
  --batch-size 8

# Headãƒ‘ãƒƒãƒãƒ³ã‚°ï¼ˆé¸æŠãƒ˜ãƒƒãƒ‰ï¼‰
python3 -m src.analysis.run_phase6_head_patching \
  --profile baseline \
  --model <model> \
  --heads 0:0-11 3:0-11 6:0-11 9:0-11 11:0-11 \
  --max-samples 8 \
  --sequence-length 30 \
  --device mps \
  --batch-size 8
```

## ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆ

### 1. å®Ÿè¡Œè¨­å®š

| ãƒ¢ãƒ‡ãƒ« | å±¤æ•° | ãƒ˜ãƒƒãƒ‰æ•°/å±¤ | ç·ãƒ˜ãƒƒãƒ‰æ•° | ã‚µãƒ³ãƒ—ãƒ«æ•° | ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°æ™‚é–“ | ãƒ‘ãƒƒãƒãƒ³ã‚°æ™‚é–“ |
|--------|------|-----------|-----------|-----------|-----------------|--------------|
| GPT-2 small | 12 | 12 | 144 | 8 | 106.18ç§’ | 1.17ç§’ |
| Pythia-160M | 12 | 12 | 144 | 8 | 106.18ç§’ | 1.17ç§’ |
| GPT-Neo-125M | 12 | 12 | 144 | 8 | 101.58ç§’ | 1.05ç§’ |

**å…±é€šè¨­å®š**:
- **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«**: `baseline`
- **sequence_length**: 30ãƒˆãƒ¼ã‚¯ãƒ³
- **ãƒãƒƒãƒã‚µã‚¤ã‚º**: 8
- **è©•ä¾¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: sentiment, politeness, goemotionsï¼ˆè¤‡æ•°ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰

### 2. Headã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°çµæœ

#### 2.1 GPT-2 small

**ç·ã‚¹ã‚³ã‚¢æ•°**: 5,040ï¼ˆ144ãƒ˜ãƒƒãƒ‰ Ã— 35ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰

**ä¸Šä½5ãƒ˜ãƒƒãƒ‰ï¼ˆdelta_meançµ¶å¯¾å€¤ï¼‰**:
1. Layer 0 Head 8: 0.3982 (goemotions.excitement)
2. Layer 0 Head 6: -0.3136 (sentiment.positive)
3. Layer 0 Head 8: -0.2904 (goemotions.neutral)
4. Layer 0 Head 2: -0.2451 (sentiment.positive)
5. Layer 0 Head 6: 0.2428 (sentiment.negative)

**å±¤åˆ¥å¹³å‡deltaï¼ˆçµ¶å¯¾å€¤ï¼‰**:
- Layer 0: 0.0184ï¼ˆæœ€ã‚‚é«˜ã„ï¼‰
- Layer 1: 0.0122
- Layer 2: 0.0086
- Layer 3: 0.0071
- Layer 4: 0.0067

**è¦³å¯Ÿ**:
- Layer 0ã®ãƒ˜ãƒƒãƒ‰ãŒæœ€ã‚‚å¤§ããªå½±éŸ¿ã‚’ç¤ºã™
- Head 8ã¨Head 6ãŒè¤‡æ•°ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§é«˜ã„å½±éŸ¿

#### 2.2 Pythia-160M

**ç·ã‚¹ã‚³ã‚¢æ•°**: 5,040ï¼ˆ144ãƒ˜ãƒƒãƒ‰ Ã— 35ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰

**ä¸Šä½5ãƒ˜ãƒƒãƒ‰ï¼ˆdelta_meançµ¶å¯¾å€¤ï¼‰**:
1. Layer 0 Head 5: -0.2314 (goemotions.neutral)
2. Layer 6 Head 5: -0.2057 (goemotions.neutral)
3. Layer 2 Head 9: -0.2043 (goemotions.neutral)
4. Layer 2 Head 10: -0.2043 (goemotions.neutral)
5. Layer 2 Head 11: -0.2043 (goemotions.neutral)

**å±¤åˆ¥å¹³å‡deltaï¼ˆçµ¶å¯¾å€¤ï¼‰**:
- Layer 0: 0.0159
- Layer 1: 0.0209
- Layer 2: 0.0242ï¼ˆæœ€ã‚‚é«˜ã„ï¼‰
- Layer 3: 0.0265ï¼ˆæœ€ã‚‚é«˜ã„ï¼‰
- Layer 4: 0.0209

**è¦³å¯Ÿ**:
- Layer 2-3ã®ãƒ˜ãƒƒãƒ‰ãŒæœ€ã‚‚å¤§ããªå½±éŸ¿ã‚’ç¤ºã™
- goemotions.neutralãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç‰¹ã«å¤§ããªå¤‰åŒ–

#### 2.3 GPT-Neo-125M

**ç·ã‚¹ã‚³ã‚¢æ•°**: 5,040ï¼ˆ144ãƒ˜ãƒƒãƒ‰ Ã— 35ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼‰

**ä¸Šä½5ãƒ˜ãƒƒãƒ‰ï¼ˆdelta_meançµ¶å¯¾å€¤ï¼‰**:
1. Layer 0 Head 4: 0.3000 (goemotions.approval)
2. Layer 1 Head 8: 0.2892 (goemotions.approval)
3. Layer 1 Head 9: 0.2892 (goemotions.approval)
4. Layer 1 Head 10: 0.2892 (goemotions.approval)
5. Layer 4 Head 5: 0.2892 (goemotions.approval)

**å±¤åˆ¥å¹³å‡deltaï¼ˆçµ¶å¯¾å€¤ï¼‰**:
- Layer 0: 0.0207
- Layer 1: 0.0207
- Layer 2: 0.0210
- Layer 3: 0.0272ï¼ˆæœ€ã‚‚é«˜ã„ï¼‰
- Layer 4: 0.0293ï¼ˆæœ€ã‚‚é«˜ã„ï¼‰

**è¦³å¯Ÿ**:
- Layer 3-4ã®ãƒ˜ãƒƒãƒ‰ãŒæœ€ã‚‚å¤§ããªå½±éŸ¿ã‚’ç¤ºã™
- goemotions.approvalãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ç‰¹ã«å¤§ããªå¤‰åŒ–

### 3. ãƒ¢ãƒ‡ãƒ«é–“ã®æ¯”è¼ƒ

#### 3.1 é‡è¦ãƒ˜ãƒƒãƒ‰ã®å±¤åˆ†å¸ƒ

| ãƒ¢ãƒ‡ãƒ« | æœ€ã‚‚å½±éŸ¿ã®å¤§ãã„å±¤ | ç‰¹å¾´çš„ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹ |
|--------|-----------------|-----------------|
| GPT-2 small | Layer 0 | sentiment, goemotions.excitement |
| Pythia-160M | Layer 2-3 | goemotions.neutral |
| GPT-Neo-125M | Layer 3-4 | goemotions.approval |

**è¦³å¯Ÿ**:
- **GPT-2 small**: æµ…å±¤ï¼ˆLayer 0ï¼‰ã§å¤§ããªå½±éŸ¿
- **Pythia-160M**: ä¸­å±¤ï¼ˆLayer 2-3ï¼‰ã§å¤§ããªå½±éŸ¿
- **GPT-Neo-125M**: ä¸­å±¤ï¼ˆLayer 3-4ï¼‰ã§å¤§ããªå½±éŸ¿

#### 3.2 ãƒ¡ãƒˆãƒªã‚¯ã‚¹åˆ¥ã®å‚¾å‘

- **GPT-2 small**: sentimentã¨goemotions.excitementã§å¤§ããªå¤‰åŒ–
- **Pythia-160M**: goemotions.neutralã§å¤§ããªå¤‰åŒ–
- **GPT-Neo-125M**: goemotions.approvalã§å¤§ããªå¤‰åŒ–

### 4. Headãƒ‘ãƒƒãƒãƒ³ã‚°çµæœ

ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«ã§ä»¥ä¸‹ã®è¨­å®šã§Headãƒ‘ãƒƒãƒãƒ³ã‚°ã‚’å®Ÿè¡Œï¼š
- **å¯¾è±¡ãƒ˜ãƒƒãƒ‰**: Layer 0, 3, 6, 9, 11ã®å…¨ãƒ˜ãƒƒãƒ‰ï¼ˆå„å±¤12ãƒ˜ãƒƒãƒ‰ï¼‰
- **ç·ãƒ˜ãƒƒãƒ‰æ•°**: 60ãƒ˜ãƒƒãƒ‰
- **å®Ÿè¡Œæ™‚é–“**: ç´„1ç§’ï¼ˆéå¸¸ã«é«˜é€Ÿï¼‰

### 5. Phase 7çµ±è¨ˆè§£æã¨ã®é€£æº

Phase 6ã®çµæœã¯Phase 7ã®çµ±è¨ˆè§£æã§ä½¿ç”¨ã•ã‚Œã€ä»¥ä¸‹ã®æƒ…å ±ãŒæä¾›ã•ã‚Œã¾ã™ï¼š

- **åŠ¹æœé‡ï¼ˆCohen's dï¼‰**: å„ãƒ˜ãƒƒãƒ‰ã‚¢ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åŠ¹æœé‡
- **på€¤**: çµ±è¨ˆçš„æœ‰æ„æ€§
- **å¤šé‡æ¯”è¼ƒè£œæ­£**: Bonferroniè£œæ­£ã€BH-FDRè£œæ­£

è©³ç´°ã¯Phase 7ãƒ¬ãƒãƒ¼ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### 6. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

- **Phase 7**: Phase 6ã®çµæœã‚’ä½¿ç”¨ã—ã¦çµ±è¨ˆè§£æã‚’å®Ÿè¡Œ
  - `results/baseline/screening/head_scores_<model>.json`
  - `results/baseline/patching/head_patching/<model>_head_ablation.pkl`
- **è¿½åŠ å®Ÿé¨“**: 
  - **ã‚ˆã‚Šå¤šãã®ã‚µãƒ³ãƒ—ãƒ«ã§ã®å®Ÿè¡Œ**: ç¾åœ¨ã¯8ã‚µãƒ³ãƒ—ãƒ«ã§å®Ÿè¡Œã—ã¾ã—ãŸãŒã€baselineãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ¬æ¥ã®æƒ³å®šã¯225ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ãŸã ã—ã€ãƒ•ãƒ«å®Ÿè¡Œï¼ˆ12å±¤ Ã— 12ãƒ˜ãƒƒãƒ‰ Ã— 225ã‚µãƒ³ãƒ—ãƒ«ï¼‰ã™ã‚‹ã¨éå¸¸ã«é•·æ™‚é–“ï¼ˆæ•°æ—¥ç¨‹åº¦ï¼‰ã‹ã‹ã‚‹ãŸã‚ã€ã¾ãšã¯å‹•ä½œç¢ºèªã¨ã—ã¦8ã‚µãƒ³ãƒ—ãƒ«ã§å®Ÿè¡Œã—ã¾ã—ãŸã€‚
  - é‡è¦ãƒ˜ãƒƒãƒ‰ã®çµ„ã¿åˆã‚ã›ãƒ‘ãƒƒãƒãƒ³ã‚°
  - ä»–ã®è©•ä¾¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§ã®åˆ†æ

### 7. è€ƒå¯Ÿ

- **ãƒ¢ãƒ‡ãƒ«é–“ã®é•ã„**: 3ãƒ¢ãƒ‡ãƒ«ã§é‡è¦ãƒ˜ãƒƒãƒ‰ã®å±¤åˆ†å¸ƒãŒç•°ãªã‚Šã€ãƒ¢ãƒ‡ãƒ«ã”ã¨ã«ç•°ãªã‚‹æ„Ÿæƒ…å‡¦ç†æ§‹é€ ã‚’æŒã¤ã“ã¨ãŒç¤ºå”†ã•ã‚Œã‚‹
- **æµ…å±¤vsæ·±å±¤**: GPT-2ã¯æµ…å±¤ã€Pythiaã¨GPT-Neoã¯ä¸­å±¤ã§å¤§ããªå½±éŸ¿ã‚’ç¤ºã™
- **ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç‰¹ç•°æ€§**: ãƒ¢ãƒ‡ãƒ«ã”ã¨ã«ç•°ãªã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã§å¤§ããªå¤‰åŒ–ã‚’ç¤ºã—ã€ãƒ¢ãƒ‡ãƒ«å›ºæœ‰ã®æ„Ÿæƒ…è¡¨ç¾æ§‹é€ ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§

