# Phase 4 â€” Simple Activation Patching

## ğŸ¯ ç›®çš„

- æ„Ÿæƒ…ãƒ™ã‚¯ãƒˆãƒ«æ–¹å‘ patching
- next-token logits ã¸ã®å½±éŸ¿ã‚’è¦‹ã‚‹
- åŸºæœ¬çš„ãªå› æœåŠ¹æœã®ç¢ºèª

## ğŸ“¦ ç”Ÿæˆç‰©

- Patching logs
- Next-token shifts
- `docs/phase4_report.md`

## ğŸš€ å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ä¾‹

```bash
python -m src.models.activation_patching --model gpt2 \
  --vectors_file results/baseline/emotion_vectors/gpt2_vectors_token_based.pkl \
  --prompts_file data/neutral_prompts.json \
  --output results/baseline/patching/gpt2_patching.pkl
```

## ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆé …ç›®

### 1. Patching ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

#### ä½¿ç”¨ã—ãŸè¨­å®š
- ãƒ¢ãƒ‡ãƒ«: [gpt2 / pythia-160m / gpt-neo-125M]
- ãƒ™ã‚¯ãƒˆãƒ«ãƒ•ã‚¡ã‚¤ãƒ«: [ãƒ‘ã‚¹]
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: [ãƒ‘ã‚¹]
- å±¤: [å±¤ç•ªå·]
- Î±å€¤: [å€¤]
- max_new_tokens: [æ•°]

#### Patchingè¨­å®š
- patch_mode: [v_only / pattern_v / result]
- patch_window: [æ•°] (è©²å½“ã™ã‚‹å ´åˆ)
- patch_positions: [ä½ç½®] (è©²å½“ã™ã‚‹å ´åˆ)
- alpha_schedule: [ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«] (è©²å½“ã™ã‚‹å ´åˆ)

### 2. Top-token å¤‰åŒ–ï¼ˆbefore/afterï¼‰

#### Baselineç”Ÿæˆ

| ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ | Top-1 Token | Top-1 Prob | Top-5 Tokens |
|----------|------------|-----------|--------------|
| [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ1] | [token] | [ç¢ºç‡] | [tokens] |
| [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ2] | [token] | [ç¢ºç‡] | [tokens] |

#### Patchingå¾Œç”Ÿæˆ

| ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ | Emotion | Top-1 Token | Top-1 Prob | Top-5 Tokens |
|----------|---------|------------|-----------|--------------|
| [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ1] | Gratitude | [token] | [ç¢ºç‡] | [tokens] |
| [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ1] | Anger | [token] | [ç¢ºç‡] | [tokens] |
| [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ1] | Apology | [token] | [ç¢ºç‡] | [tokens] |

### 3. æ„Ÿæƒ…æ–¹å‘å¼·åº¦ï¼ˆÎ± å€¤ï¼‰

#### Î±å€¤ã«ã‚ˆã‚‹å¤‰åŒ–

| Î±å€¤ | Gratitude | Anger | Apology |
|-----|----------|-------|---------|
| -2.0 | [åŠ¹æœ] | [åŠ¹æœ] | [åŠ¹æœ] |
| -1.0 | [åŠ¹æœ] | [åŠ¹æœ] | [åŠ¹æœ] |
| 0.0  | [åŠ¹æœ] | [åŠ¹æœ] | [åŠ¹æœ] |
| 1.0  | [åŠ¹æœ] | [åŠ¹æœ] | [åŠ¹æœ] |
| 2.0  | [åŠ¹æœ] | [åŠ¹æœ] | [åŠ¹æœ] |

### 4. Multi-tokenç”Ÿæˆã®åŠ¹æœ

#### å˜ä¸€ãƒˆãƒ¼ã‚¯ãƒ³ vs Multi-token

| ç”Ÿæˆé•· | æ¤œå‡ºå¯èƒ½ãªå¤‰åŒ– |
|--------|--------------|
| 1 token | [Yes/No] |
| 10 tokens | [Yes/No] |
| 30 tokens | [Yes/No] |

### 5. ãƒ©ãƒ³ãƒ€ãƒ å¯¾ç…§å®Ÿé¨“

#### ãƒ©ãƒ³ãƒ€ãƒ ãƒ™ã‚¯ãƒˆãƒ«ã¨ã®æ¯”è¼ƒ
- æ„Ÿæƒ…ãƒ™ã‚¯ãƒˆãƒ«åŠ¹æœ: [å€¤]
- ãƒ©ãƒ³ãƒ€ãƒ ãƒ™ã‚¯ãƒˆãƒ«åŠ¹æœ: [å€¤]
- Cohen's d: [å€¤]
- çµ±è¨ˆçš„æœ‰æ„æ€§: [på€¤]

### 6. è€ƒå¯Ÿ

#### å› æœåŠ¹æœã®ç¢ºèª
- [patchingã«ã‚ˆã‚‹å› æœåŠ¹æœã®ç¢ºèªçµæœ]

#### Î±å€¤ã®å½±éŸ¿
- [Î±å€¤ãŒå‡ºåŠ›ã«ä¸ãˆã‚‹å½±éŸ¿]

#### å±¤ä¾å­˜æ€§
- [å±¤ã«ã‚ˆã‚‹åŠ¹æœã®é•ã„]

#### æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸ã®æº–å‚™
- [Phase 5ã§ã®ã‚¹ã‚¤ãƒ¼ãƒ—å®Ÿé¨“ã¸ã®ç¤ºå”†]

## ğŸ“ å‚™è€ƒ

[ãã®ä»–ã®æ³¨æ„äº‹é …ã‚„ãƒ¡ãƒ¢]

