# Emotion Circuits Project

è»½é‡LLMã‚’ç”¨ã„ãŸã€Œæ„Ÿæƒ…è¡¨ç¾å›è·¯ã€æ¢ç´¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLLMï¼‰ã¯ã€äººé–“ã®ã‚ˆã†ãªã€Œæ„Ÿè¬ã€ã€Œæ€’ã‚Šã€ã€Œè¬ç½ªã€ãªã©ã®æ„Ÿæƒ…ãƒ»ç¤¾ä¼šçš„è¡¨ç¾ã‚’è‡ªç„¶ã«ç”Ÿæˆã—ã¾ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã‚‰ã®æ„Ÿæƒ…ãŒãƒ¢ãƒ‡ãƒ«å†…éƒ¨ã§ã©ã®ã‚ˆã†ã«è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã®ã‹ï¼ˆã©ã®å±¤ãƒ»ã©ã®æ–¹å‘ãƒ»ã©ã®å›è·¯ãŒæ‹…å½“ã—ã¦ã„ã‚‹ã‹ï¼‰ã«ã¤ã„ã¦ã¯æœªè§£æ˜ã§ã™ã€‚

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€è»½é‡ãªã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹LLMã‚’è¤‡æ•°ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨ã—ã€æ„Ÿæƒ…ã®å†…éƒ¨è¡¨ç¾ã‚’è§£æã—ã€ãƒ¢ãƒ‡ãƒ«é–“ã§å…±é€šæ€§ãŒã‚ã‚‹ã‹ã‚’æ¤œè¨¼ã™ã‚‹ç ”ç©¶ã‚’è¡Œã„ã¾ã™ã€‚

**æ ¸å¿ƒçš„ãªç ”ç©¶ã‚¯ã‚¨ã‚¹ãƒãƒ§ãƒ³**: ã€Œç•°ãªã‚‹LLMã®ä¸­ã«ã€"åº§æ¨™ç³»ã¯é•ã†ãŒæœ¬è³ªçš„ã«ã¯åŒã˜" æ„Ÿæƒ…è¡¨ç¾ã®éƒ¨åˆ†ç©ºé–“ã¯å­˜åœ¨ã™ã‚‹ã®ã‹ï¼Ÿãã—ã¦ãã‚Œã‚’å› æœçš„ã«æ“ä½œã§ãã‚‹ã®ã‹ï¼Ÿã€

## å¯¾è±¡ãƒ¢ãƒ‡ãƒ«

1. **GPT-2 small (124M)** - å¤å…¸çš„æ§‹é€ ã®åŸºæº–ãƒ¢ãƒ‡ãƒ«ã¨ã—ã¦å¿…é ˆ
2. **Pythia-160M** - GPT-Neoç³»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€è¨“ç·´ãƒ‡ãƒ¼ã‚¿ãŒé€æ˜
3. **GPT-Neo-125M** - GPT-Neoç³»ï¼ˆTinyLlamaã®ä»£æ›¿ï¼‰

## å®Ÿè£…çŠ¶æ³

### å®Œäº†ã—ãŸãƒ•ã‚§ãƒ¼ã‚º

- âœ… **ãƒ•ã‚§ãƒ¼ã‚º0**: ç’°å¢ƒæ§‹ç¯‰
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º1**: æ„Ÿæƒ…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆï¼ˆè‹±èªã®ã¿ï¼‰
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º2**: å†…éƒ¨æ´»æ€§ã®æŠ½å‡º
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º3**: æ„Ÿæƒ…æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã®æŠ½å‡ºãƒ»å¯è¦–åŒ–
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º3.5**: æ„Ÿæƒ…èªãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®ãƒ™ã‚¯ãƒˆãƒ«æŠ½å‡ºã¨ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹è§£æ
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º4ãƒ©ã‚¤ãƒˆ**: ç°¡æ˜“Activation Patching
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º5**: å±¤Ã—Î±ã®ã‚¹ã‚¤ãƒ¼ãƒ—å®Ÿé¨“ã¨å› æœåŠ›æ¯”è¼ƒ
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º6**: ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹æ§‹é€ ã¨ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆï¼ˆç·šå½¢å†™åƒå­¦ç¿’ã€k-sweepã€Procrustesã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆï¼‰
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º7**: Head/Unitãƒ¬ãƒ™ãƒ«è§£æï¼ˆhead screeningã€ablationã€patchingï¼‰

### å®Ÿè£…æ¸ˆã¿ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

#### ãƒ‡ãƒ¼ã‚¿å‡¦ç†
- `src/data/create_emotion_dataset.py` - æ„Ÿæƒ…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆ
- `src/data/validate_dataset.py` - ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ¤œè¨¼

#### ãƒ¢ãƒ‡ãƒ«æ“ä½œ
- `src/models/extract_activations.py` - å†…éƒ¨æ´»æ€§æŠ½å‡º
- `src/models/activation_patching.py` - ç°¡æ˜“Activation Patching
- `src/models/activation_patching_sweep.py` - å±¤Ã—Î±ã‚¹ã‚¤ãƒ¼ãƒ—å®Ÿé¨“
- `src/models/activation_patching_iterative.py` - Iterative Patching
- `src/models/activation_patching_swap.py` - Swap Patching
- `src/models/head_ablation.py` - Head ablationå®Ÿé¨“
- `src/models/head_patching.py` - Head patchingå®Ÿé¨“

#### åˆ†æ
- `src/analysis/emotion_vectors.py` - æ„Ÿæƒ…æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«æŠ½å‡ºï¼ˆæ–‡æœ«ãƒ™ãƒ¼ã‚¹ï¼‰
- `src/analysis/emotion_vectors_token_based.py` - æ„Ÿæƒ…æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«æŠ½å‡ºï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ï¼‰
- `src/analysis/emotion_subspace.py` - æ„Ÿæƒ…ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹è§£æï¼ˆPCAï¼‰
- `src/analysis/cross_model_analysis.py` - ãƒ¢ãƒ‡ãƒ«é–“æ¯”è¼ƒ
- `src/analysis/cross_model_token_based.py` - ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«é–“æ¯”è¼ƒ
- `src/analysis/cross_model_subspace.py` - ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«é–“æ¯”è¼ƒ
- `src/analysis/subspace_utils.py` - ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹è§£æãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆPCAã€ä¸»è§’åº¦ã€overlapã€ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆï¼‰
- `src/analysis/model_alignment.py` - Neutralç©ºé–“ã§ã®ç·šå½¢å†™åƒå­¦ç¿’
- `src/analysis/subspace_k_sweep.py` - ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹æ¬¡å…ƒkã®ã‚¹ã‚¤ãƒ¼ãƒ—å®Ÿé¨“
- `src/analysis/subspace_alignment.py` - Procrustes/CCAã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
- `src/analysis/compare_patching_methods.py` - Patchingæ‰‹æ³•ã®æ¯”è¼ƒ
- `src/analysis/sentiment_eval.py` - Sentimentè©•ä¾¡
- `src/analysis/head_screening.py` - Headã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°

#### å¯è¦–åŒ–
- `src/visualization/emotion_plots.py` - æ„Ÿæƒ…ãƒ™ã‚¯ãƒˆãƒ«å¯è¦–åŒ–
- `src/visualization/patching_heatmaps.py` - Patchingãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—
- `src/visualization/sentiment_plots.py` - Sentimentå¯è¦–åŒ–
- `src/visualization/alignment_plots.py` - ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆçµæœå¯è¦–åŒ–
- `src/visualization/layer_subspace_plots.py` - å±¤ã”ã¨ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹å¯è¦–åŒ–
- `src/visualization/head_plots.py` - Headè§£æçµæœå¯è¦–åŒ–

#### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- `src/utils/hf_hooks.py` - HuggingFaceãƒ¢ãƒ‡ãƒ«ç”¨ãƒ•ãƒƒã‚¯ï¼ˆPhase 8ç”¨ï¼‰

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Python 3.9ä»¥ä¸Šï¼ˆ3.11æ¨å¥¨ï¼‰
- [uv](https://github.com/astral-sh/uv) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆæ¨å¥¨ï¼‰
- CUDAå¯¾å¿œGPUï¼ˆæ¨å¥¨ã€CPUã§ã‚‚å‹•ä½œå¯èƒ½ï¼‰
- 8GBä»¥ä¸Šã®ãƒ¡ãƒ¢ãƒªï¼ˆGPUä½¿ç”¨æ™‚ã¯16GBä»¥ä¸Šæ¨å¥¨ï¼‰

### ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

1. **ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³**
```bash
git clone <repository-url>
cd emotion-circuits-project
```

2. **ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆï¼ˆuvã‚’ä½¿ç”¨ï¼‰**
```bash
uv venv
source .venv/bin/activate  # Linux/Mac
# ã¾ãŸã¯
.venv\Scripts\activate  # Windows
```

3. **ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
# uvã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ˆæ¨å¥¨ï¼‰
uv pip install -e .

# ã¾ãŸã¯é€šå¸¸ã®pipã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
pip install -r requirements.txt
pip install -e .
```

4. **å‹•ä½œç¢ºèª**
```bash
python -m src.models.extract_activations --help
```

**è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã¯ [`SETUP.md`](SETUP.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚**

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
emotion-circuits-project/
â”œâ”€â”€ data/                      # ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ
â”‚   â”œâ”€â”€ neutral_prompts.json   # ä¸­ç«‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆ50æ–‡ï¼‰
â”‚   â”œâ”€â”€ gratitude_prompts.json # æ„Ÿè¬ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚   â”œâ”€â”€ anger_prompts.json     # æ€’ã‚Šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆä½œæˆãŒå¿…è¦ï¼‰
â”‚   â””â”€â”€ apology_prompts.json   # è¬ç½ªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆä½œæˆãŒå¿…è¦ï¼‰
â”œâ”€â”€ docs/                      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ proposal/              # ä¼ç”»æ›¸
â”‚   â”œâ”€â”€ implementation_plan.md # å®Ÿè£…è¨ˆç”»ï¼ˆè©³ç´°ï¼‰
â”‚   â”œâ”€â”€ phase2_report.md       # Phase 2ãƒ¬ãƒãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ phase3_report.md       # Phase 3ãƒ¬ãƒãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ phase3.5_and_4light_report.md  # Phase 3.5/4 Lightãƒ¬ãƒãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ phase5_report.md       # Phase 5ãƒ¬ãƒãƒ¼ãƒˆ
â”‚   â””â”€â”€ phase6_expansion_report.md     # Phase 6ãƒ¬ãƒãƒ¼ãƒˆ
â”œâ”€â”€ notebooks/                 # Jupyterãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯
â”œâ”€â”€ results/                   # å®Ÿé¨“çµæœ
â”‚   â”œâ”€â”€ activations/           # æŠ½å‡ºã—ãŸæ´»æ€§ãƒ‡ãƒ¼ã‚¿
â”‚   â”‚   â”œâ”€â”€ gpt2/
â”‚   â”‚   â”œâ”€â”€ pythia-160m/
â”‚   â”‚   â””â”€â”€ gpt-neo-125m/
â”‚   â”œâ”€â”€ emotion_vectors/       # æ„Ÿæƒ…æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«
â”‚   â”œâ”€â”€ subspaces/             # ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ patching/              # Patchingå®Ÿé¨“çµæœ
â”‚   â”œâ”€â”€ alignment/             # ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆå®Ÿé¨“çµæœ
â”‚   â”‚   â”œâ”€â”€ linear_maps/       # ç·šå½¢å†™åƒ
â”‚   â”‚   â””â”€â”€ *.json, *.pkl     # å®Ÿé¨“çµæœ
â”‚   â”œâ”€â”€ evaluation/            # è©•ä¾¡çµæœ
â”‚   â””â”€â”€ plots/                 # å¯è¦–åŒ–çµæœ
â”‚       â”œâ”€â”€ cross_model/
â”‚       â”œâ”€â”€ k_sweep/
â”‚       â”œâ”€â”€ alignment/
â”‚       â””â”€â”€ heads/
â”œâ”€â”€ src/                       # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ data/                  # ãƒ‡ãƒ¼ã‚¿å‡¦ç†
â”‚   â”œâ”€â”€ models/                 # ãƒ¢ãƒ‡ãƒ«æ“ä½œ
â”‚   â”œâ”€â”€ analysis/              # åˆ†æãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ visualization/         # å¯è¦–åŒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â””â”€â”€ utils/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ tests/                     # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ pyproject.toml             # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šãƒ»ä¾å­˜é–¢ä¿‚
â””â”€â”€ README.md                  # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ä½¿ç”¨æ–¹æ³•

### 1. ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æº–å‚™

æ„Ÿæƒ…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆï¼ˆæ—¢ã«`data/`ã«ä¸€éƒ¨å­˜åœ¨ï¼‰ï¼š

```bash
python -m src.data.create_emotion_dataset --output data/emotion_dataset.jsonl
```

### 2. å†…éƒ¨æ´»æ€§ã®æŠ½å‡º

ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰å†…éƒ¨æ´»æ€§ã‚’æŠ½å‡ºï¼š

```bash
# GPT-2 small
python -m src.models.extract_activations \
  --model gpt2 \
  --dataset data/emotion_dataset.jsonl \
  --output results/activations/gpt2/

# Pythia-160M
python -m src.models.extract_activations \
  --model EleutherAI/pythia-160m \
  --dataset data/emotion_dataset.jsonl \
  --output results/activations/pythia-160m/
```

### 3. æ„Ÿæƒ…æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã®æŠ½å‡º

```bash
# æ–‡æœ«ãƒ™ãƒ¼ã‚¹
python -m src.analysis.emotion_vectors \
  --activations_dir results/activations/gpt2 \
  --output results/emotion_vectors/gpt2_vectors.pkl

# ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹
python -m src.analysis.emotion_vectors_token_based \
  --activations_dir results/activations/gpt2 \
  --output results/emotion_vectors/gpt2_vectors_token_based.pkl
```

### 4. ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹è§£æ

```bash
# æ„Ÿæƒ…ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹ã®è¨ˆç®—
python -m src.analysis.emotion_subspace \
  --activations_dir results/activations/gpt2 \
  --output results/subspaces/gpt2_subspaces.pkl \
  --n-components 10

# k-sweepå®Ÿé¨“
python -m src.analysis.subspace_k_sweep \
  --activations_dir results/activations \
  --model1 gpt2 \
  --model2 pythia-160m \
  --output results/alignment/k_sweep_gpt2_pythia.json \
  --k-values 2 5 10 20 \
  --layers 3 5 7 9 11
```

### 5. ãƒ¢ãƒ‡ãƒ«é–“ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ

```bash
# Neutralç©ºé–“ã§ã®ç·šå½¢å†™åƒå­¦ç¿’
python -m src.analysis.model_alignment \
  --model1 gpt2 \
  --model2 EleutherAI/pythia-160m \
  --neutral_prompts_file data/neutral_prompts.json \
  --model1_activations_dir results/activations/gpt2 \
  --model2_activations_dir results/activations/pythia-160m \
  --output results/alignment/model_alignment_gpt2_pythia.pkl \
  --n-components 10 \
  --layers 3 5 7 9 11
```

### 6. Activation Patchingå®Ÿé¨“

```bash
# å±¤Ã—Î±ã‚¹ã‚¤ãƒ¼ãƒ—å®Ÿé¨“
python -m src.models.activation_patching_sweep \
  --model gpt2 \
  --vectors_file results/emotion_vectors/gpt2_vectors_token_based.pkl \
  --prompts_file data/neutral_prompts.json \
  --output results/patching/gpt2_sweep.pkl \
  --layers 3 5 7 9 11 \
  --alpha -2 -1 -0.5 0 0.5 1 2
```

### 7. Headè§£æ

```bash
# Headã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
python -m src.analysis.head_screening \
  --model gpt2 \
  --output results/alignment/head_scores_gpt2.json

# Head ablation
python -m src.models.head_ablation \
  --model gpt2 \
  --head-spec "3:5,7:2" \
  --prompts-file data/gratitude_prompts.json \
  --output results/patching/head_ablation_gpt2_gratitude.pkl

# Head patching
python -m src.models.head_patching \
  --model gpt2 \
  --head-spec "3:5,7:2" \
  --neutral-prompts data/neutral_prompts.json \
  --emotion-prompts data/gratitude_prompts.json \
  --output results/patching/head_patching_gpt2_gratitude.pkl
```

### 8. å¯è¦–åŒ–

```bash
# Headè§£æçµæœã®å¯è¦–åŒ–
python -m src.visualization.head_plots \
  --head-scores results/alignment/head_scores_gpt2.json \
  --ablation-file results/patching/head_ablation_gpt2_gratitude.pkl \
  --patching-file results/patching/head_patching_gpt2_gratitude.pkl \
  --output-dir results/plots/heads

# ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆçµæœã®å¯è¦–åŒ–
python -m src.visualization.alignment_plots \
  --results_file results/alignment/model_alignment_gpt2_pythia.pkl \
  --output_dir results/plots/alignment
```

## ä¸»è¦ãªç™ºè¦‹

### Phase 6ã®æ ¸å¿ƒçš„ãªç™ºè¦‹

1. **ä½æ¬¡å…ƒã§ã®å…±æœ‰æ§‹é€ **: k-sweepå®Ÿé¨“ã«ã‚ˆã‚Šã€k=2ã§overlapãŒæœ€ã‚‚é«˜ãï¼ˆ0.002ã€œ0.005ï¼‰ã€ã‚³ã‚¢ãªå…±æœ‰å› å­ãŒä½æ¬¡å…ƒã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¤ºå”†

2. **ç·šå½¢å†™åƒã«ã‚ˆã‚‹å¤§å¹…ãªæ”¹å–„**: Neutralç©ºé–“ã§å­¦ç¿’ã—ãŸç·šå½¢å†™åƒã«ã‚ˆã‚Šã€æ„Ÿæƒ…ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹ã®overlapãŒ**0.53ã€œ0.99**ã¾ã§å¤§å¹…ã«æ”¹å–„ã€‚ã“ã‚Œã¯ã€Œåº§æ¨™ç³»ã¯é•ã†ãŒæœ¬è³ªçš„ã«ã¯åŒã˜æ§‹é€ ã€ã¨ã„ã†ä»®èª¬ã‚’å¼·ãæ”¯æŒ

3. **å±¤ä¾å­˜æ€§**: æ·±ã„å±¤ï¼ˆ9, 11ï¼‰ã§ç‰¹ã«ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆåŠ¹æœãŒå¤§ãã„ã€‚Layer 9ã§ã¯ã€Angerã¨Apologyã§overlapãŒ1.0ï¼ˆå®Œå…¨ä¸€è‡´ï¼‰ã«åˆ°é”

è©³ç´°ã¯`docs/phase6_expansion_report.md`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿

- `data/neutral_prompts.json`: ä¸­ç«‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ50æ–‡
- `data/gratitude_prompts.json`: æ„Ÿè¬ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆ10æ–‡ï¼‰
- `data/anger_prompts.json`: æ€’ã‚Šãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆä½œæˆãŒå¿…è¦ï¼‰
- `data/apology_prompts.json`: è¬ç½ªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆä½œæˆãŒå¿…è¦ï¼‰

### çµæœãƒ‡ãƒ¼ã‚¿

å®Ÿé¨“çµæœã¯`results/`ä»¥ä¸‹ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼š

- **æ´»æ€§ãƒ‡ãƒ¼ã‚¿**: `results/activations/{model_name}/activations_{emotion}.pkl`
- **æ„Ÿæƒ…ãƒ™ã‚¯ãƒˆãƒ«**: `results/emotion_vectors/{model}_vectors.pkl`
- **ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹**: `results/subspaces/{model}_subspaces.pkl`
- **ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆçµæœ**: `results/alignment/*.pkl`, `results/alignment/*.json`
- **Patchingçµæœ**: `results/patching/*.pkl`
- **å¯è¦–åŒ–**: `results/plots/**/*.png`

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### GPUãƒ¡ãƒ¢ãƒªä¸è¶³

- ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹
- CPUãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œï¼ˆ`--device cpu`ï¼‰
- ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹

### TransformerLensã®ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼

- ãƒ¢ãƒ‡ãƒ«åã‚’ç¢ºèªï¼ˆ`gpt2`, `EleutherAI/pythia-160m`ãªã©ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªï¼ˆåˆå›ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ï¼‰
- HuggingFaceã®èªè¨¼ãŒå¿…è¦ãªå ´åˆï¼ˆLlamaãªã©ï¼‰ã¯`huggingface-cli login`

### ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼

- `results/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- å¿…è¦ãªè¦ªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè‡ªå‹•ä½œæˆã™ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ï¼‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçµ±è¨ˆ

- **å®Ÿè£…æ¸ˆã¿Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: 31ãƒ•ã‚¡ã‚¤ãƒ«
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: 8ãƒ¬ãƒãƒ¼ãƒˆï¼ˆPhase 2-6ã®è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆå«ã‚€ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«**: 2ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆneutral, gratitudeï¼‰
- **å®Ÿè£…å®Œäº†ãƒ•ã‚§ãƒ¼ã‚º**: Phase 0-7ï¼ˆPhase 8ã¯éƒ¨åˆ†çš„ï¼‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚§ãƒ¼ã‚º

è©³ç´°ãªå®Ÿè£…è¨ˆç”»ã¯ `docs/implementation_plan.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

- âœ… **ãƒ•ã‚§ãƒ¼ã‚º0**: ç’°å¢ƒæ§‹ç¯‰
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º1**: æ„Ÿæƒ…ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º2**: å†…éƒ¨æ´»æ€§ã®æŠ½å‡º
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º3**: æ„Ÿæƒ…æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã®æŠ½å‡ºãƒ»å¯è¦–åŒ–
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º3.5**: æ„Ÿæƒ…èªãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®å†æ¤œè¨¼
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º4ãƒ©ã‚¤ãƒˆ**: ç°¡æ˜“Activation Patching
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º5**: å±¤Ã—Î±ã‚¹ã‚¤ãƒ¼ãƒ—å®Ÿé¨“ã¨å› æœåŠ›æ¯”è¼ƒ
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º6**: ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹æ§‹é€ ã¨ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
- âœ… **ãƒ•ã‚§ãƒ¼ã‚º7**: Head/Unitãƒ¬ãƒ™ãƒ«è§£æ
- ğŸ”„ **ãƒ•ã‚§ãƒ¼ã‚º8**: ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºã¨æ™®éæ€§ï¼ˆéƒ¨åˆ†çš„ã«å®Ÿè£…æ¸ˆã¿ï¼‰

## ç ”ç©¶ã‚¯ã‚¨ã‚¹ãƒãƒ§ãƒ³ï¼ˆRQï¼‰

- **RQ1**: æ„Ÿè¬ãƒ»æ€’ã‚Šãƒ»è¬ç½ªãªã©ã®æ„Ÿæƒ…ã¯ã€å±¤ã”ã¨ã«å®‰å®šã—ãŸæ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã¨ã—ã¦ç¾ã‚Œã‚‹ã‹ï¼Ÿ
- **RQ2**: ç•°ãªã‚‹LLMé–“ã§ã€åŒã˜æ„Ÿæƒ…æ–¹å‘ã¯ã©ã‚Œãã‚‰ã„ä¼¼ã¦ã„ã‚‹ã‹ï¼Ÿï¼ˆã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«ï¼‰
- **RQ3**: æ„Ÿæƒ…æ–¹å‘ã‚’æ“ä½œï¼ˆå¢—å¹…ãƒ»æŠ‘åˆ¶ï¼‰ã™ã‚‹ã¨ã€å‡ºåŠ›ãƒˆãƒ¼ãƒ³ã¯å¤‰åŒ–ã™ã‚‹ã‹ï¼Ÿ
- **RQ4**: ç‰¹å®šã®attention headã‚„MLP unitãŒæ„Ÿæƒ…ã‚’å¼·ãæ‹…ã£ã¦ã„ã‚‹ã‹ï¼Ÿ
- **RQ5**: ç•°ãªã‚‹LLMé–“ã§ã€Neutralç©ºé–“ã§ã®ç·šå½¢å†™åƒã«ã‚ˆã‚Šæ„Ÿæƒ…ã‚µãƒ–ã‚¹ãƒšãƒ¼ã‚¹ã¯ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆã§ãã‚‹ã‹ï¼Ÿ

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

[ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±ã‚’è¿½åŠ ]

## å‚è€ƒæ–‡çŒ®

- TransformerLens: https://github.com/neelnanda-io/TransformerLens
- HuggingFace Transformers: https://huggingface.co/docs/transformers

## è²¢çŒ®

[è²¢çŒ®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’è¿½åŠ ]

## é€£çµ¡å…ˆ

[é€£çµ¡å…ˆæƒ…å ±ã‚’è¿½åŠ ]
